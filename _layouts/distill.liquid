<!doctype html>
<html>
  <head>
    {% include head.liquid %}

    <!-- Distill js -->
    <script src="{{ '/assets/js/distillpub/template.v2.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/distillpub/transforms.v2.js' | relative_url }}"></script>
    {% if page._styles %}
      <!-- Page/Post style -->
      <style type="text/css">
        {{ page._styles }}
      </style>
    {% endif %}
    
    <!-- Custom styles for byline modification -->
    <style>
      /* GitHub styling to match other sections */
      d-byline .github-section {
        grid-column: 2;
        text-align: left;
        margin: 0;
        box-sizing: border-box;
      }
      
      d-byline .github-section h3 {
        font-size: 0.6rem;
        font-weight: 400;
        margin: 0;
        text-transform: uppercase;
      }
      
      d-byline .github-section a {
        font-size: 0.8rem;
        color: rgba(0, 0, 0, 0.8);
        text-decoration: none;
      }
      
      d-byline .github-section a:hover {
        text-decoration: underline;
      }

      /* Adjust the other columns when GitHub is present */
      d-byline .authors-affiliations {
        grid-column: 1;
      }
      
      d-byline .published {
        grid-column: 3;
      }
      
      /* Hide affiliations when empty */
      d-byline .affiliations:empty,
      d-byline .affiliations:empty + h3 {
        display: none;
      }
    </style>
  </head>

  <d-front-matter>
    <script async type="text/json">
      {
        "title": "{{ page.title }}",
        "description": "{{ page.description }}",
        "published": "{{ page.date | date: '%B %d, %Y' }}",
        "authors": [
          {% for author in page.authors %}
          {
            "author": "{{ author.name }}",
            "authorURL": "{{ author.url }}"{% if author.affiliations.name %},
            "affiliations": [
              {
                "name": "{{ author.affiliations.name }}",
                "url": "{{ author.affiliations.url }}"
              }
            ]{% endif %}
          }{% if forloop.last == false %},{% endif %}
          {% endfor %}
        ],
        "katex": {
          "delimiters": [
            {
              "left": "$",
              "right": "$",
              "display": false
            },
            {
              "left": "$$",
              "right": "$$",
              "display": true
            }
          ]
        }
      }
    </script>
  </d-front-matter>

  <body class="{% if site.navbar_fixed %}fixed-top-nav{% endif %} {% unless site.footer_fixed %}sticky-bottom-footer{% endunless %}">
    <!-- Header -->
    {% include header.liquid %}

    <!-- Content -->
    <div class="post distill">
      <d-title>
        <h1>{{ page.title }}</h1>
        <p>{{ page.description }}</p>
      </d-title>
      
      {% if page.authors %}
        <d-byline></d-byline>
        
        {% if page.github_repo %}
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            // Ensure the d-byline component is fully loaded
            setTimeout(function() {
              const byline = document.querySelector('d-byline');
              
              if (byline) {
                // Get the grid container within the byline
                const grid = byline.shadowRoot ? 
                             byline.shadowRoot.querySelector('.byline') : 
                             byline.querySelector('.byline');
                
                if (grid) {
                  // Add GitHub section
                  const githubSection = document.createElement('div');
                  githubSection.className = 'github-section';
                  
                  const githubHeading = document.createElement('h3');
                  githubHeading.textContent = 'GITHUB';
                  
                  const githubLink = document.createElement('a');
                  githubLink.href = "{{ page.github_repo }}";
                  githubLink.textContent = "{{ page.github_repo | split: '/' | last }}";
                  githubLink.target = "_blank";
                  
                  githubSection.appendChild(githubHeading);
                  githubSection.appendChild(githubLink);
                  
                  // Find where to insert it - right after authors but before published
                  const authorsSection = grid.querySelector('.authors-affiliations');
                  const publishedSection = grid.querySelector('.published');
                  
                  if (authorsSection && publishedSection) {
                    grid.insertBefore(githubSection, publishedSection);
                    
                    // Force grid to be 3 columns
                    grid.style.gridTemplateColumns = "repeat(3, 1fr)";
                    
                    // Adjust other sections
                    authorsSection.style.gridColumn = "1";
                    githubSection.style.gridColumn = "2";
                    publishedSection.style.gridColumn = "3";
                  }
                  
                  // Hide affiliations section if empty
                  const hasAffiliations = {% if page.authors[0].affiliations.name %} true {% else %} false {% endif %};
                  if (!hasAffiliations) {
                    const affiliationsHeader = grid.querySelector('h3:nth-of-type(2)');
                    const affiliationsSection = grid.querySelector('.affiliations');
                    if (affiliationsHeader) affiliationsHeader.style.display = 'none';
                    if (affiliationsSection) affiliationsSection.style.display = 'none';
                  }
                }
              }
            }, 100); // Small delay to ensure components are loaded
          });
        </script>
        {% endif %}
      {% endif %}

      <d-article>
        {% if page.toc %}
          <d-contents>
            <nav class="l-text figcaption">
              <h3>Contents</h3>
              {% for section in page.toc %}
                <div>
                  <a href="#{{ section.name | slugify }}">{{ section.name }}</a>
                </div>
                {% if section.subsections %}
                  <ul>
                    {% for subsection in section.subsections %}
                      <li>
                        <a href="#{{ subsection.name | slugify }}">{{ subsection.name }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              {% endfor %}
            </nav>
          </d-contents>
        {% endif %}
        {{ content }}
      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

      <d-bibliography src="{{ page.bibliography | prepend: '/assets/bibliography/' | relative_url }}"></d-bibliography>

      {% if site.disqus_shortname and page.disqus_comments %}{% include disqus.liquid %}{% endif %}
      {% if site.giscus.repo and page.giscus_comments %}
        {% include giscus.liquid %}
      {% endif %}
    </div>

    <!-- Footer -->
    {% include footer.liquid %}

    <!-- JavaScripts -->
    {% include distill_scripts.liquid %}
  </body>
</html>
